(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{530:function(a,s,e){"use strict";e.r(s);var t=e(6),n=Object(t.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p",[a._v("當很多套件發佈到 npm 上進行開發的時候，項目一多，開發以及發布的環境得版本號控制就會複雜，導致很多時候開發者不是專注在程式碼上，而是在各個工具間依賴的整理。 Lerna 提供了一套自動化管理套件的方式，透過 Lerna 我們可以更容易專注在某個功能修正、發布，不用擔心開發環境的版本號的問題。就讓我們來看看這個好用的工具吧。")]),a._v(" "),e("h2",{attrs:{id:"背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[a._v("#")]),a._v(" 背景")]),a._v(" "),e("p",[a._v("開發一個項目時，當需求越來越大，功能越變越複雜，漸漸的轉成中大型項目，導致多人維護上的困擾時，這時候就會考慮把功能切分成更細的 package，並且針對該 package 的功能進行測試撰寫，使開發人員可以更專注在當前的 package 下的功能。")]),a._v(" "),e("p",[a._v("從這個想法出發，就會想為每個 package 存放在一個 repo，各個倚賴互相 install 來使用。")]),a._v(" "),e("p",[a._v("但多個 repo 相互依賴也產生了其他問題：")]),a._v(" "),e("ol",[e("li",[a._v("package 版本更新後，開發人員需要執行 "),e("code",[a._v("npm link")]),a._v(" ，以便維護版本號的替換。")]),a._v(" "),e("li",[a._v("issue 難以統一追蹤、管理，分散在太多 repo 了。")]),a._v(" "),e("li",[a._v("每個 package 都有獨立的 node_modules，且工具通常會大同小異(babel, webpack)，開發時，各個項目安裝耗時且佔用空間。")])]),a._v(" "),e("h2",{attrs:{id:"monorepo-vs-multirepo"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#monorepo-vs-multirepo"}},[a._v("#")]),a._v(" Monorepo vs Multirepo")]),a._v(" "),e("p",[a._v("先來了解一下名詞：")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://i.imgur.com/pUsnozN.png",alt:""}})]),a._v(" "),e("p",[e("code",[a._v("這裡的 mono 跟 multi 指的是每個 repo 管理得模塊 packages 數量")])]),a._v(" "),e("h3",{attrs:{id:"monorepo-monolithic-repository"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#monorepo-monolithic-repository"}},[a._v("#")]),a._v(" Monorepo(monolithic repository)")]),a._v(" "),e("p",[a._v("單體式倉庫，單一 repo 管理多個 package。")]),a._v(" "),e("p",[a._v("優點：")]),a._v(" "),e("ul",[e("li",[a._v("方便版本管理，以及模塊之間的依賴引用，測試、開發都會比較方便，相關工具可以統一使用。")]),a._v(" "),e("li",[a._v("issue、log 的 tracking 非常方便。")])]),a._v(" "),e("p",[a._v("缺點：")]),a._v(" "),e("ul",[e("li",[a._v("倉庫體積會變大。")]),a._v(" "),e("li",[a._v("針對 module 的自由度較低，統一的工具(測試、建構)需要嚴謹的使用。")])]),a._v(" "),e("h3",{attrs:{id:"multirepo-multiple-repository"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#multirepo-multiple-repository"}},[a._v("#")]),a._v(" Multirepo(multiple repository)")]),a._v(" "),e("p",[a._v("多體式倉庫，一個 repo 管理一個 package，")]),a._v(" "),e("p",[a._v("優點：")]),a._v(" "),e("ul",[e("li",[a._v("各模塊管理自由度較高，可自行選擇構建工具，依賴管理，單元測試等配套設施。")])]),a._v(" "),e("p",[a._v("缺點：")]),a._v(" "),e("ul",[e("li",[a._v("issue、log 管理混乱。")]),a._v(" "),e("li",[a._v("測試複雜，對多個相關聯 module 測試繁瑣。")])]),a._v(" "),e("h2",{attrs:{id:"lerna"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lerna"}},[a._v("#")]),a._v(" Lerna")]),a._v(" "),e("blockquote",[e("p",[a._v("A tool for managing JavaScript projects with multiple packages.")])]),a._v(" "),e("p",[a._v("一個多模塊管理工具。")]),a._v(" "),e("h3",{attrs:{id:"基本目錄結構"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基本目錄結構"}},[a._v("#")]),a._v(" 基本目錄結構")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("my-lerna-repo/\n    ┣━ packages/\n    ┃    ┣━ package-1/\n    ┃    ┃      ┣━ ...\n    ┃    ┃      ┗━ package.json\n    ┃    ┗━ package-2/\n    ┃           ┣━ ...\n    ┃           ┗━ package.json\n    ┣━ ...\n    ┣━ lerna.json\n    ┗━ package.json\n\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br")])]),e("h2",{attrs:{id:"安裝並初始化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安裝並初始化"}},[a._v("#")]),a._v(" 安裝並初始化")]),a._v(" "),e("p",[a._v("安裝 Lerna 到全域環境")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -global lerna\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("在當前目錄初始化")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna init\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("一開始會是 packages 會是空的")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("my-lerna-repo/\n    ┣━ packages/\n    ┣━ lerna.json\n    ┗━ package.json\n\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("p",[a._v("其中根目錄的 package.json")]),a._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[a._v('"name"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"root"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[a._v('"private"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[a._v('"devDependencies"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[a._v('"lerna"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"^3.22.1"')]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br")])]),e("h6",{attrs:{id:"private-為-true-為私有的-管理所有項目的-不會被發布-與其他要發佈到-npm-的-package-解耦。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#private-為-true-為私有的-管理所有項目的-不會被發布-與其他要發佈到-npm-的-package-解耦。"}},[a._v("#")]),a._v(" private: 為 true 為私有的，管理所有項目的，不會被發布，與其他要發佈到 npm 的 package 解耦。")]),a._v(" "),e("h3",{attrs:{id:"初始化模式選擇"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#初始化模式選擇"}},[a._v("#")]),a._v(" 初始化模式選擇：")]),a._v(" "),e("p",[e("strong",[a._v("1. Fixed/Locked 模式（默認）")])]),a._v(" "),e("p",[a._v("多個 packages (或子模組)，統一使用同一版本號，當其中一個更新，其餘的 package 無論有無更新，都會一併更新版號。")]),a._v(" "),e("blockquote",[e("p",[a._v("版本號保存在項目根目錄下 lerna.json 文件中的 version 下。")])]),a._v(" "),e("p",[e("strong",[a._v("2. Independent 模式（--independent)")])]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna init --independent\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("各個 packages 可以依照獨立的情況個別更新本版號。")]),a._v(" "),e("blockquote",[e("p",[a._v("獨立模式下，lerna.json version 將會被忽略。")])]),a._v(" "),e("h2",{attrs:{id:"在根目錄下建立-package"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在根目錄下建立-package"}},[a._v("#")]),a._v(" 在根目錄下建立 package")]),a._v(" "),e("p",[a._v("在 packages/ 下面會多一個 package-01 的資料結構")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna create package-01\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h6",{attrs:{id:"也可以手動新增專案的資料結構-需要自行建立-npm-init-或-yarn-init-y-而每個專案都是認-package-json-為基準。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#也可以手動新增專案的資料結構-需要自行建立-npm-init-或-yarn-init-y-而每個專案都是認-package-json-為基準。"}},[a._v("#")]),a._v(" 也可以手動新增專案的資料結構，需要自行建立 npm init 或 yarn init -ｙ，而每個專案都是認 package.json 為基準。")]),a._v(" "),e("h2",{attrs:{id:"對每個-package-安裝其他模塊工具"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#對每個-package-安裝其他模塊工具"}},[a._v("#")]),a._v(" 對每個 package 安裝其他模塊工具")]),a._v(" "),e("h3",{attrs:{id:"加入第三方套件或工具"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#加入第三方套件或工具"}},[a._v("#")]),a._v(" 加入第三方套件或工具")]),a._v(" "),e("p",[a._v("比如我的每個 package 都會需要用到 Vue 框架，則執行：")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" vue@next\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("在每個 package 以及 Lerna 根目錄中的 package.json 新增 Vue 框架了。")]),a._v(" "),e("h3",{attrs:{id:"各個-package-間彼此依賴"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#各個-package-間彼此依賴"}},[a._v("#")]),a._v(" 各個 package 間彼此依賴")]),a._v(" "),e("ol",[e("li",[a._v("將 package-1 安裝到 package-2")])]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" package-1 --scope"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("package-2\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[a._v("將 package-1 安裝到 package-2 的 devDependencies 下")])]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" package-1 --scope"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("package-2 --dev \n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("ol",{attrs:{start:"3"}},[e("li",[a._v("將 package-1 安裝到除 package-1 以外的所有模塊")])]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" package-1\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h3",{attrs:{id:"安裝套件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安裝套件"}},[a._v("#")]),a._v(" 安裝套件")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna bootstrap\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("如同執行 "),e("code",[a._v("npm install")]),a._v(" 會在各個 package 裡安裝所有項目的依賴。")]),a._v(" "),e("ol",[e("li",[a._v("若 packages 之間有相同的第三方套件時，Lerna 會在根目錄下直接創建 node_modules，並關聯至所有的 package。")]),a._v(" "),e("li",[a._v("將所有相互依賴的 Lerna packages 鏈接在一起。")]),a._v(" "),e("li",[a._v("在安裝好的 package 中執行 "),e("code",[a._v("npm run prepublish")]),a._v(" 和 "),e("code",[a._v("npm run prepare")]),a._v("。")])]),a._v(" "),e("blockquote",[e("p",[a._v("若是想要針對每個 package 獨立新增其他第三方套件可以到該 package 目錄下面執行 "),e("code",[a._v("npm install <package>[@version]")])])]),a._v(" "),e("p",[a._v("但這樣做會發現，每個 packages 都會有自己的 node_modules，導致安裝套件時程過長以及佔用空間。這樣對於多個 packages 都用到的套件，會被多個 package 安裝多次，並且每個 package 下都維護 node_modules，不清爽。於是我們使用 –hoist 來把每個 package 下的依賴包都提升到工程根目錄，來降低安裝以及管理的成本。")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna bootstrap --hoist  \n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("若不想次都輸入 --hoist ，可以在 lerna.json 配置：")]),a._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[a._v('"command"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[a._v('"bootstrap"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v('\n      "hoist'),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br")])]),e("h3",{attrs:{id:"其他相關指令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其他相關指令"}},[a._v("#")]),a._v(" 其他相關指令")]),a._v(" "),e("h4",{attrs:{id:"_1-移除套件或工具"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-移除套件或工具"}},[a._v("#")]),a._v(" 1. 移除套件或工具")]),a._v(" "),e("p",[a._v("移除套件或工具，Lerna 並沒有提供移除的指令，但是可以透過 Lerna 提供的 exec 執行腳本的指令來執行 "),e("code",[a._v("npm uninstall")])]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -- "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("command"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("args"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("例如：")]),a._v(" "),e("ul",[e("li",[a._v("在所有 package 下執行移除 jquery 的指令。")])]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -- "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" uninstall jquery\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("ul",[e("li",[a._v("在 package-01 下執行移除 jquery 的指令。")])]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" --scope"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("package-01 "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" uninstall jquery\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h4",{attrs:{id:"_2-清除-node-modules"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-清除-node-modules"}},[a._v("#")]),a._v(" 2.清除 node_modules")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna clean\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h4",{attrs:{id:"_3-檢查-package-是否變更過"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-檢查-package-是否變更過"}},[a._v("#")]),a._v(" 3.檢查 package 是否變更過")]),a._v(" "),e("p",[a._v("除非 package.json 有設定 "),e("code",[a._v("private: true")]),a._v("，不然只要更新過都會檢測到。")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna updated\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h4",{attrs:{id:"_4-查看-package-列表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-查看-package-列表"}},[a._v("#")]),a._v(" 4.查看 package 列表")]),a._v(" "),e("p",[a._v("除非 package.json 有設定 "),e("code",[a._v("private: true")]),a._v("，則可透過列表可以確認現在管理 publish 項目的 package 是否跟設定的一樣。")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lerna list\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h4",{attrs:{id:"_5-執行-package-的-package-json-中的-script-腳本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-執行-package-的-package-json-中的-script-腳本"}},[a._v("#")]),a._v(" 5.執行 package 的 package.json 中的 script 腳本")]),a._v(" "),e("ul",[e("li",[a._v("運行所有包的 serve 命令")])]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ lerna run serve\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("ul",[e("li",[a._v("觀看所有包並在更改時發報，流式處理前綴輸出")])]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ lerna run --parallel "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("watch")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("ul",[e("li",[a._v("運行 package-01 模塊下的 serve 命令")])]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ lerna run --scope package-01 serve\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h4",{attrs:{id:"_6-發布"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-發布"}},[a._v("#")]),a._v(" 6.發布")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ lerna public\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("ul",[e("li",[a._v("每個包若有變更則會更新版號並且發佈至對應的 npm 倉庫。")]),a._v(" "),e("li",[a._v("發佈當前提交中打了 tag 的包")]),a._v(" "),e("li",[a._v("發佈在之前的提交中更新的未經版本化的 「canary」 版本的軟件包（及其依賴項）")])]),a._v(" "),e("blockquote",[e("p",[a._v("Lerna 不會發佈在 package.json 中將 private 屬性設置為 true 的模塊")])]),a._v(" "),e("h2",{attrs:{id:"結論"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#結論"}},[a._v("#")]),a._v(" 結論")]),a._v(" "),e("p",[a._v("Lerna 不負責建構跟測試等任務，他單純的是一種管理 package 的目錄模式，提供了一套自動化管理程序，讓開發者可以更專注在開發上，不用因為各個項目之間依賴而產生其他非程式邏輯上的操作，在根目錄下就可以掌握全部的項目。之後再來討論我們該如何透過 Lerna 來完成各個 package 統一管理、commit 提交、代碼格式化等操作。")]),a._v(" "),e("h5",{attrs:{id:"來源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#來源"}},[a._v("#")]),a._v(" 來源：")]),a._v(" "),e("ol",[e("li",[e("a",{attrs:{href:"https://codingnote.cc/zh-hk/p/1600/",target:"_blank",rel:"noopener noreferrer"}},[a._v("基於 Lerna 管理 packages 的 Monorepo 項目最佳實踐"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://juejin.cn/post/6844903985900421127#heading-9",target:"_blank",rel:"noopener noreferrer"}},[a._v("使用 Lerna 管理模块"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);